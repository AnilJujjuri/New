from azure.iot.device import IoTHubModuleClient
import logging

from azurecom import CommunicationModule
logger = logging.getLogger(__name__)

can_interface = 'vcan0'
connection_string = "HostName=EDGTneerTrainingPractice.azure-devices.net;DeviceId=nodered;ModuleId=SimulatedTemperatureSensor;SharedAccessKey=v1cnONzs99unf3XKKACDfx0E69/bE5INBg/o0A7sKXw="

# Create an instance of the IoTHubModuleClient
client = IoTHubModuleClient.create_from_connection_string(connection_string)

# Instantiate the CommunicationModule
with CommunicationModule(connection_string=connection_string, can_interface=can_interface) as module:
    # Connect to the Azure IoT Hub
    module.connect()

    # Get the current properties from the device twin
    properties = module.get_properties()
    print(properties)

    # Update the properties in the device twin
    data_to_insert = {"sensor_id": 123, "temperature": 25.5, "humidity": 60.2}
    module.update_property(data_to_insert)

    # Get the updated properties from the device twin
    properties = module.get_properties()
    print(properties)

    # Disconnect from the Azure IoT Hub
    module.disconnect()
