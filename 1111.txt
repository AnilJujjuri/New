from opcua import Client
from opcua.ua import NodeId

# Connect to the OPC UA server
url = "opc.tcp://localhost:53530/OPCUA/SimulationServer"
client = Client(url)
client.connect()

# Subscribe to data changes
subscription = client.create_subscription(100, None)

# Define the data change callback function
def data_change_callback(_, data):
    item = data.monitored_item.NodeId.to_string()
    value = data.monitored_item.Value.Value
    print("Data change from server:")
    print(f'Item "{item}", Value = Double({value:.6f})')

# Create a monitored item to track the data change
node_id = NodeId.from_string("ns=3;i=1003")
monitored_item = subscription.subscribe_data_change(node_id)
monitored_item.add_callback(data_change_callback)

# Keep the program running until manually interrupted
try:
    while True:
        pass
except KeyboardInterrupt:
    pass

# Disconnect from the server
client.disconnect()
