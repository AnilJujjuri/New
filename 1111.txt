from opcua import Client


def print_value(item):
    node_id = item.NodeId
    value = item.Value.Value
    print(f'Data change from server:')
    print(f'Item "{node_id}", Value = {value}')


if __name__ == '__main__':
    client = Client("opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer")
    client.connect()

    print("Client created")

    node_id = "ns=3;i=1012"
    value = 20
    client.write_attribute(node_id, "Value", value)

    print("Value written successfully")

    subscription = client.create_subscription(2000, None)
    handle = subscription.subscribe_data_change(print_value, "ns=3;i=1003")

    print("Created")
    print("Subscribed")

    try:
        while True:
            pass
    finally:
        subscription.unsubscribe(handle)
        client.disconnect()
