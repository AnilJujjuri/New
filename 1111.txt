from opcua import Client
from opcua.ua import NodeId, AttributeIds, DataValue
import time

def main():
    client = Client("opc.tcp://MYTSL02946.lnties.com:53530/OPCUA/SimulationServer")
    client.connect()

    print("Client created")

    node_id = NodeId(3, 1012)
    value = 20

    try:
        while True:
            # Write the value to the node
            client.write_attribute(node_id, AttributeIds.Value, DataValue(value=value))

            print("Value written successfully")

            # Read the value from the node
            node = client.get_node(node_id)
            data_value = node.get_value()
            if data_value is not None:
                print(f"Item \"{node_id}\", Value = {data_value.Value}")
            else:
                print(f"Item \"{node_id}\", Value not found")

            # Increment the value for the next iteration
            value += 1

            # Wait for some time before the next iteration
            time.sleep(2)

    except KeyboardInterrupt:
        pass

    client.disconnect()

if __name__ == '__main__':
    main()
