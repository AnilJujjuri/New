import socket
from pymodbus.server.sync import ModbusTcpServer
from pymodbus.datastore import ModbusSlaveContext, ModbusServerContext

hostname = socket.gethostname()
server_ip_address = socket.gethostbyname(hostname)
server_port = 502
store = ModbusSlaveContext(zero_mode=True)
context = ModbusServerContext(slaves=store, single=True)

server = ModbusTcpServer(context, address=(server_ip_address, server_port))
print("[+]Info : Server Started on IP : {I} and PORT : {P} ".format(I=server_ip_address, P=server_port))

try:
    server.serve_forever()
except KeyboardInterrupt:
    print("Server stopped.")
finally:
    server.server_close()
