import minimalmodbus
from time import sleep

# Modbus TCP server settings
IP_ADDRESS = '0.0.0.0'  # Listen on all available network interfaces
PORT = 502

# Create a Modbus instrument instance (slave)
modbus_server = minimalmodbus.Server(port=PORT, address=1)

try:
    print(f"Starting Modbus TCP server on {IP_ADDRESS}:{PORT}")
    modbus_server.serial.port = IP_ADDRESS
    modbus_server.clear_responses()
    while True:
        modbus_server.handle_request()  # Handle incoming requests
        sleep(0.01)  # Sleep to avoid high CPU usage
except KeyboardInterrupt:
    print("Modbus TCP server stopped.")
