import random
from pyModbusTCP.server import ModbusServer
import time

 

SERVER_IP = "0.0.0.0"
SERVER_PORT = 2109

 

# Create a Modbus server instance
server = ModbusServer(host=SERVER_IP, port=SERVER_PORT, no_block=True)

 

# Initialize random temperature and pressure values
temperature = random.randint(0, 100)
pressure = random.randint(800, 1200)

 

try:
    print(f"Starting Modbus server at {SERVER_IP}:{SERVER_PORT}...")
    server.start()

 

    while True:
        # Generate random temperature and pressure values
        temperature = random.randint(0, 100)
        pressure = random.randint(800, 1200)
        # print(f"{temperature} and {pressure}")
        # Update holding registers
        server.data_bank.set_holding_registers(0, [temperature, pressure])
        print(server.data_bank.get_holding_registers(0,2))
        time.sleep(2)

 

except KeyboardInterrupt:
    print("Stopping Modbus server...")
    server.stop()
