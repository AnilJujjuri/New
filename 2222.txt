from modbus_tk import modbus_tcp
from modbus_tk.defines import ModbusSlave

# Create a Modbus TCP server
server = modbus_tcp.TcpServer(port=502)

# Create a Modbus slave instance
slave = server.add_slave(1)

# Add a block of holding registers (40000-49999)
slave.add_block('holding', ModbusSlave.HOLDING_REGISTERS, 40000, 100)

# Start the Modbus server
server.start()
print("Modbus TCP server is running...")

try:
    # Run the server indefinitely
    server.join()
except KeyboardInterrupt:
    # Stop the server on keyboard interrupt
    server.stop()
    print("Modbus TCP server stopped.")
