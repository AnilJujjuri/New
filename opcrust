from opcua import Client
import time

# OPC UA server endpoint URL
server_url = "opc.tcp://localhost:4840/freeopcua/server/"

# Connect to the OPC UA server
client = Client(server_url)
client.connect()

# Get the root node
root = client.get_root_node()

# Create a session
session = client.create_session()

# Iterate to create data
for i in range(10):
    # Create a new variable node
    var_node = root.add_variable(2, "MyVariable{}".format(i), i)
    var_node.set_writable()  # Set the variable as writable

    # Start the session
    session.start()

    # Read the value of the variable
    value = var_node.get_value()

    # Print the value
    print("Value of MyVariable{}: {}".format(i, value))

    # Sleep for 1 second
    time.sleep(1)

    # Set a new value to the variable
    new_value = i + 1
    var_node.set_value(new_value)

    # Print the new value
    print("New value of MyVariable{}: {}".format(i, new_value))

    # Stop the session
    session.stop()

# Disconnect from the server
client.disconnect()
